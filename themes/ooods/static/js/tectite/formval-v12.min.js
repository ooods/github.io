(function(){var TectiteFormValidator;var iMobileWidth=320;var bKeepMesg=!1;var aTargetForms=[];const TectiteFormDesignerField='form-control';const TectiteFieldError='is-invalid';function loadScript(url,callback){var script=document.createElement("script")
script.type="text/javascript";if(script.readyState){script.onreadystatechange=function(){if(script.readyState=="loaded"||script.readyState=="complete"){script.onreadystatechange=null;callback()}}}else{script.onload=function(){callback()}}
script.src=url;document.getElementsByTagName("head")[0].appendChild(script)}
function TectiteFormValidator($){var validator=this;var s_ajax_img_path='';var s_error_submit="The form is not complete. Please fix the errors before submitting.";var s_error_field_empty="Please enter a value for this field.";var s_error_radio_reqd="Please select one of the options.";var s_error_select_reqd="Please select a value for this field.";var s_error_checkbox_reqd="You must check this box.";String.prototype.tectite_ltrim=function(){return(this.replace(/^\s*/,""))};String.prototype.tectite_rtrim=function(){return(this.replace(/\s*$/,""))};String.prototype.tectite_trim=function(){return(this.tectite_ltrim().tectite_rtrim())};function GetArgs(){var args=new Object();var query=location.search.substring(1);var pairs=query.split("&");for(var i=0;i<pairs.length;i++){var pos=pairs[i].indexOf('=');if(pos==-1)continue;var argname=pairs[i].substring(0,pos);var value=pairs[i].substring(pos+1);value=decodeURIComponent(value);args[argname]=value}
return args}
var nDebugLevel=0;var oURLArgs=GetArgs();if(oURLArgs.formval&&oURLArgs.formval=="off")
return;$(document).ready(function(){Initialize()});if(oURLArgs.debug){if(oURLArgs.debug==="off")
nDebugLevel=0;else if(!isNaN(parseInt(oURLArgs.debug)))
nDebugLevel=parseInt(oURLArgs.debug);if(nDebugLevel){window.tectite_debug_level=nDebugLevel;window.tectite_setdebug=function(){nDebugLevel=window.tectite_debug_level}}}
function logMesg(m_data){if(typeof console!='undefined'&&typeof console.log!='undefined'){console.log(m_data);return!0}else{return!1}}
function Debug(i_level){var s_mesg="";if(arguments.length>1&&i_level<=nDebugLevel){for(var ii=1;ii<arguments.length;ii++){s_mesg+=arguments[ii]}
if(!logMesg(s_mesg)){s_mesg+="\r\n\r\n"+"Click Cancel to switch off further debug messages for 2 seconds.";if(!confirm(s_mesg)){nDebugLevel=0;window.setTimeout(window.tectite_setdebug,2000)}}}}
function Initialize(){var a_reqd=[];var a_cond=[];var j_form_list=$('form');Debug(5,"Initialize");j_form_list.each(function(){var j_form=$(this);var j_mode=j_form.find('input[name=fmmode]');Debug(5,'Found form');if(j_mode.length>0&&(j_mode.val()=='auto'||j_mode.val()=='ajax')){Debug(5,'Found form with fmmode = '+j_mode.val());$(j_mode).val('ajax');aTargetForms.push(j_form);s_ajax_img_path='';if(typeof tectite_form_environ!=='undefined'&&typeof tectite_form_environ.img_url!=='undefined'&&tectite_form_environ.img_url!==null){s_ajax_img_path=tectite_form_environ.img_url;if(typeof tectite_form_environ.keep_mesg!="undefined"){bKeepMesg=tectite_form_environ.keep_mesg}}else if(typeof form_environ!=='undefined'&&typeof form_environ.img_url!=='undefined'&&form_environ.img_url!==null){s_ajax_img_path=form_environ.img_url}
recordBackClicks(j_form);AjaxSetup(j_form,s_ajax_img_path);j_form.find('input[type=submit]').parents('form').submit({j_form:j_form},function(ev){ev.preventDefault();AjaxSubmit(ev.data.j_form);return!1})}else{Debug(5,'Found form without active fmmode field: '+j_mode.length)}})}
function recordBackClicks(j_form){var j_form=j_form;var j_go_back=j_form.find('[name=multi_go_back]');j_go_back.each(function(){var j_button=$(this);if(isPushButton(this)){j_button.click(function(ev){j_form.data('tectite_back_clicked',!0)})}})}
function getLabel(j_elem){var s_id=j_elem.attr('id');var j_label;j_label=j_elem.closest('form').find('label[for="'+s_id+'"]');if(j_label.length==0){j_elem.parent('label')}
return j_label}
function saveWidth(j_label){j_label.data('formval_old_width',j_label.css('width'));j_label.css('width','auto')}
function restoreWidth(j_label){var i_width=j_label.data('formval_old_width');if(i_width!==null){j_label.css('width',i_width);j_label.removeData('formval_old_width')}}
function addErrorMessage(j_elem,s_mesg){var j_div=j_elem.closest('.'+TectiteFormDesignerField);Debug(5,'addErrorMessage: '+s_mesg);if(j_div.length>0){j_div.addClass(TectiteFieldError);recordErrorClass(j_elem,j_div);Debug(4,"addErrorMessage: adding class to div: '",j_div.attr('class'),"'");recordErrorElems(j_elem,addErrorMesg2Div(j_div,s_mesg))}else if($(window).width()<=iMobileWidth){var j_label=getLabel(j_elem);logMesg('label for id= "'+j_elem.attr('id')+'": '+(j_label.length>0?'found':'not found'));if(j_label.length){recordErrorElems(j_elem,addMessage2Element(j_label,s_mesg));saveWidth(j_label)}
else{recordErrorElems(j_elem,addMessageNearElement(j_elem,s_mesg))}}else{recordErrorElems(j_elem,addMessageNearElement(j_elem,s_mesg))}}
function recordErrorClass(j_elem,j_error_class){var m_list;m_list=j_elem.data('formval_error_classed');if(!m_list){m_list=[]}
m_list.push(j_error_class);Debug(6,'recordErrorClass: element '+j_elem.prop('tagName')+' for '+j_elem.attr('name'));j_elem.data('formval_error_classed',m_list)}
function recordErrorElems(j_elem,m_list){var m_list=[].concat(m_list);Debug(6,'Recording '+m_list.length+' error elements for '+j_elem.attr('name'));j_elem.data('formval_errors',m_list)}
function removeErrorElems(j_elem){var m_list;m_list=j_elem.data('formval_errors');if(m_list){Debug(6,'Removing '+m_list.length+' error elements for '+j_elem.attr('name'));$.each(m_list,function(i_index,j_added){j_added.remove()});j_elem.removeData('formval_errors')}
m_list=j_elem.data('formval_error_classed');if(m_list){Debug(6,'Removing class from '+m_list.length+' elements for '+j_elem.attr('name'));$.each(m_list,function(i_index,j_el){j_el.removeClass(TectiteFieldError)});j_elem.removeData('formval_error_classed')}}
function addMessage2Element(j_elem,s_mesg){var s_span;s_span='<span class="'+TectiteFieldError+' formval_added">'+s_mesg+'</span>';return $(s_span).appendTo(j_elem)}
function addMessageNearElement(j_elem,s_mesg){var j_span;var a_added=[];j_span=$('<span class="'+TectiteFieldError+' formval_added">'+s_mesg+'</span>');if(isRadio(j_elem)){a_added.push(j_span.insertBefore(j_elem));a_added.push($('<br class="formval_added">').insertBefore(j_elem))}else{a_added.push(j_span.insertAfter(j_elem))}
return a_added}
function addErrorMesg2Div(j_div,s_mesg){return $('<p class="'+TectiteFieldError+' formval_added">'+s_mesg+'</p>').appendTo(j_div)}
function removeErrorMessage(elem){var node=null;if(elem.tectite_error_mesg_node){var o_node_info=elem.tectite_error_mesg_node;node=o_node_info.GetParent().removeChild(o_node_info.GetChild());Debug(4,"removeErrorMessage: removed node");elem.tectite_error_mesg_node=null}
var e_div;if((e_div=FindParentDiv(elem,TectiteFormDesignerField))!==null){e_div.className=e_div.className.replace(new RegExp('\s*'+TectiteFieldError),"");Debug(4,"removeErrorMessage: removed class from div: '",e_div.className,"'")}
return(node)}
function isField(j_elem){switch(j_elem.prop('tagName').toLowerCase()){case "input":case "select":case "button":case "textarea":return(!0);default:return(!1)}}
function isRadio(j_elem){if(j_elem.prop('tagName').toLowerCase()==="input")
return(j_elem.attr('type').toLowerCase()==="radio");return(!1)}
function isCheckbox(j_elem){if(j_elem.prop('tagName').toLowerCase()==="input")
return(j_elem.attr('type').toLowerCase()==="checkbox");return(!1)}
function isSelect(j_elem){return(j_elem.prop('tagName').toLowerCase()==="select")}
function isPushButton(j_elem){switch(j_elem.prop('tagName').toLowerCase()){case "input":switch(j_elem.attr('type').toLowerCase()){case "button":case "reset":case "submit":return(!0)}
return(!1);case "button":return(!0);default:return(!1)}}
function isInputField(j_elem){return(isField(j_elem)&&j_elem.attr('type').toLowerCase()!="hidden")}
function AjaxSetup(m_form,s_img_url){var j_form=$(m_form);var mesgs={loading_img:'<img src="ajax-loading.gif" alt="" />',done_img:'<img src="ajax-done.gif" alt="" />',done_mesg:'Message sent.',error_img:'<img src="ajax-error.gif" alt="" />',error_mesg:'Error!'};function AdjustImgTag(s_url,s_img){return(s_img.replace(/src="/,'src="'+s_url))}
for(var s_fld in mesgs){if(s_fld.indexOf('_img')!=-1)
$(AdjustImgTag(s_img_url,mesgs[s_fld]))}
j_form.data('progress_loading',AdjustImgTag(s_img_url,mesgs.loading_img));j_form.data('progress_done',AdjustImgTag(s_img_url,mesgs.done_img)+'&#160;'+mesgs.done_mesg);j_form.data('progress_error',AdjustImgTag(s_img_url,mesgs.error_img)+'&#160;'+mesgs.error_mesg)}
function AjaxSubmit(j_form){if(j_form.data('tectite_back_clicked')){return}
var s_data=j_form.serialize();var j_progress=j_form.find('.TectiteAjaxProgress');function setProgress(s_stage,s_mesg){if(typeof s_mesg==='undefined'||s_mesg===null){s_mesg=''}
if(s_stage===null){j_progress.html(s_mesg)}
else{j_progress.html(j_form.data('progress_'+s_stage)+s_mesg)}}
function clearProgress(){j_progress.html('');if(j_form.data('tprogress')){clearTimeout(j_form.data('tprogress'));j_form.data('tprogress',null)}}
function isInvalid(j_elem){return(j_elem.hasClass(TectiteFieldError))}
function resetInvalid(j_elem){var j_label=getLabel(j_elem);restoreWidth(j_label);removeErrorElems(j_elem);j_elem.removeClass(TectiteFieldError)}
function markInvalid(j_elem,s_mesg){if(!isInvalid(j_elem)){if(!s_mesg){if(isRadio(j_elem))
s_mesg=s_error_radio_reqd;else if(isSelect(j_elem))
s_mesg=s_error_select_reqd;else if(isCheckbox(j_elem))
s_mesg=s_error_checkbox_reqd;else s_mesg=s_error_field_empty}
if(isRadio(j_elem)){var s_name=j_elem.attr('name');var j_buttons=j_elem.parents('form').find('input[type=radio][name="'+s_name+'"]');j_buttons.addClass(TectiteFieldError);addErrorMessage(j_buttons.first(),s_mesg)}
else{j_elem.addClass(TectiteFieldError);addErrorMessage(j_elem,s_mesg)}}
Debug(2,"markInvalid: Field ",j_elem.attr('name')," is now class '",j_elem.attr('class'),"'")}
function resetReCaptcha(){if(typeof grecaptcha!=='undefined'){grecaptcha.reset()}else{$('#recaptcha_reload').click()}}
function displayError(error_items){for(var s_fld in error_items){Debug(5,'Error for field '+s_fld);try{var j_err_elem=j_form.find('#'+s_fld+'_error');var j_field=j_form.find('[name='+s_fld+']');function reloadRecaptcha(ev){var j_elem=$(ev.target);resetReCaptcha();j_elem.val('')}
if(j_field.length==0&&s_fld==='imgverify'){j_field=j_form.find('[name=recaptcha_response_field]');j_field.focus(reloadRecaptcha)}
if(j_err_elem.length==0){j_err_elem=j_field}else{j_field.data('formval_error_elem',j_err_elem)}
if(j_err_elem.length>0){markInvalid(j_err_elem,error_items[s_fld]);function resetElement(ev){var j_field=$(ev.target);var j_err_elem=j_field.data('formval_error_elem');var s_fld_name=j_field.attr('name');if(!j_err_elem){j_err_elem=j_field}
Debug(5,'resetElement for field "'+s_fld_name+'"');resetInvalid(j_err_elem);j_field.unbind('change',resetElement);j_field.unbind('blur',resetElement);j_field.unbind('focus',reloadRecaptcha);clearProgress()};j_field.change(resetElement);j_field.blur(resetElement)}}
catch(exc){}}}
clearProgress();setProgress('loading');j_form.find('input[type=submit]').attr('disabled',!0);var s_good_url=j_form.find('input[name=good_url]').val();var o_submit={type:'POST',url:j_form.attr('action'),cache:!1,data:s_data,success:function(s_data,s_status,jqxhr){var res;var i_clear_secs=10;var o_goodurl={type:'GET',cache:!1};function complete(res){j_form.data('tprogress',setTimeout(function(){if(!bKeepMesg){clearProgress()}else{function onFocus(ev){var j_elem=$(ev.target);clearProgress();j_elem.parents('form').find('input,select,radio,textarea').unbind('focus',onFocus)}
$.each(aTargetForms,function(i_index,j_form){j_form.find('input,select,radio,textarea').focus(onFocus)})}
if(res.Result=="OK"){j_form.get(0).reset();resetReCaptcha()}},i_clear_secs*1000));j_form.find('input[type=submit]').attr('disabled',!1)}
try{if(typeof s_data=='object')
res=s_data;else res=$.parseJSON(s_data)}
catch(exc){res={Result:'FAILED',ErrorMesg:'Server returned unexpected result (JSON parse failed)'}}
if(res.Result=="OK"){function all_done(){setProgress('done');i_clear_secs=2;complete(res)}
if(s_good_url&&typeof tectite_fetch_goodurl!=='undefined'&&tectite_fetch_goodurl){o_goodurl.url=s_good_url;o_goodurl.success=all_done;$.ajax(o_goodurl)}else{all_done()}}
else{setProgress('error','&#160;'+res.ErrorMesg);logMesg(res);if(res.ErrorItems){displayError(res.ErrorItems)}
complete(res)}}};var clone=(function(){return function(obj){Clone.prototype=obj;return new Clone()};function Clone(){}}());function TryJSONP(o_submit){o_submit.dataType='jsonp';o_submit.type='GET';o_submit.async=!0;o_submit.timeout=10000;o_submit.error=function(jqxhr,s_status,m_error){if(s_status=='timeout')
setProgress(null,'Timeout....please try again later.');else setProgress('error','&#160;A network error occurred: '+s_status+'&#160;'+m_error);j_form.find('input[type=submit]').attr('disabled',!1)};$.ajax(o_submit)}
function TryCORS(o_submit){var orig_data=clone(o_submit);o_submit.dataType='json';o_submit.type='POST';o_submit.async=!0;o_submit.error=function(jqxhr,s_status,m_error){TryJSONP(orig_data)};$.ajax(o_submit)}
Debug(2,'Submitting the form via Ajax');TryCORS(o_submit)}}
if(typeof jQuery=='undefined'){loadScript("//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js",function(){TectiteFormValidator=new TectiteFormValidator(jQuery)})}else{TectiteFormValidator=new TectiteFormValidator(jQuery)}})()
